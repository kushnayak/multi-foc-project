#include <stdint.h>

#include "utils.h"

/* 12 bit precision for full unit circle; [0...2PI] -> [0...4096]
 */

static const float sin_lookup[1025] = {
    0.0000000000f,0.0015339802f,0.0030679568f,0.0046019261f,0.0061358846f,0.0076698287f,0.0092037548f,0.0107376592f,
    0.0122715383f,0.0138053885f,0.0153392063f,0.0168729879f,0.0184067299f,0.0199404286f,0.0214740803f,0.0230076815f,
    0.0245412285f,0.0260747178f,0.0276081458f,0.0291415088f,0.0306748032f,0.0322080254f,0.0337411719f,0.0352742389f,
    0.0368072229f,0.0383401204f,0.0398729276f,0.0414056410f,0.0429382569f,0.0444707719f,0.0460031821f,0.0475354842f,
    0.0490676743f,0.0505997490f,0.0521317047f,0.0536635377f,0.0551952443f,0.0567268212f,0.0582582645f,0.0597895707f,
    0.0613207363f,0.0628517576f,0.0643826309f,0.0659133528f,0.0674439196f,0.0689743276f,0.0705045734f,0.0720346532f,
    0.0735645636f,0.0750943008f,0.0766238614f,0.0781532416f,0.0796824380f,0.0812114468f,0.0827402645f,0.0842688876f,
    0.0857973123f,0.0873255352f,0.0888535526f,0.0903813609f,0.0919089565f,0.0934363358f,0.0949634953f,0.0964904314f,
    0.0980171403f,0.0995436187f,0.1010698628f,0.1025958690f,0.1041216339f,0.1056471537f,0.1071724250f,0.1086974440f,
    0.1102222073f,0.1117467112f,0.1132709522f,0.1147949266f,0.1163186309f,0.1178420615f,0.1193652148f,0.1208880872f,
    0.1224106752f,0.1239329751f,0.1254549834f,0.1269766965f,0.1284981108f,0.1300192227f,0.1315400287f,0.1330605252f,
    0.1345807085f,0.1361005752f,0.1376201216f,0.1391393442f,0.1406582393f,0.1421768035f,0.1436950332f,0.1452129247f,
    0.1467304745f,0.1482476790f,0.1497645347f,0.1512810380f,0.1527971853f,0.1543129730f,0.1558283977f,0.1573434556f,
    0.1588581433f,0.1603724572f,0.1618863938f,0.1633999494f,0.1649131205f,0.1664259035f,0.1679382950f,0.1694502912f,
    0.1709618888f,0.1724730840f,0.1739838734f,0.1754942534f,0.1770042204f,0.1785137709f,0.1800229014f,0.1815316083f,
    0.1830398880f,0.1845477369f,0.1860551517f,0.1875621286f,0.1890686641f,0.1905747548f,0.1920803970f,0.1935855873f,
    0.1950903220f,0.1965945977f,0.1980984107f,0.1996017576f,0.2011046348f,0.2026070388f,0.2041089661f,0.2056104131f,
    0.2071113762f,0.2086118520f,0.2101118369f,0.2116113274f,0.2131103199f,0.2146088110f,0.2161067971f,0.2176042746f,
    0.2191012402f,0.2205976901f,0.2220936210f,0.2235890292f,0.2250839114f,0.2265782638f,0.2280720832f,0.2295653658f,
    0.2310581083f,0.2325503070f,0.2340419586f,0.2355330594f,0.2370236060f,0.2385135948f,0.2400030224f,0.2414918853f,
    0.2429801799f,0.2444679027f,0.2459550503f,0.2474416192f,0.2489276057f,0.2504130066f,0.2518978182f,0.2533820370f,
    0.2548656596f,0.2563486825f,0.2578311022f,0.2593129151f,0.2607941179f,0.2622747070f,0.2637546790f,0.2652340303f,
    0.2667127575f,0.2681908571f,0.2696683256f,0.2711451595f,0.2726213554f,0.2740969099f,0.2755718193f,0.2770460803f,
    0.2785196894f,0.2799926431f,0.2814649379f,0.2829365705f,0.2844075372f,0.2858778347f,0.2873474595f,0.2888164082f,
    0.2902846773f,0.2917522632f,0.2932191627f,0.2946853722f,0.2961508882f,0.2976157074f,0.2990798263f,0.3005432414f,
    0.3020059493f,0.3034679466f,0.3049292297f,0.3063897954f,0.3078496400f,0.3093087603f,0.3107671527f,0.3122248139f,
    0.3136817404f,0.3151379288f,0.3165933756f,0.3180480774f,0.3195020308f,0.3209552324f,0.3224076788f,0.3238593665f,
    0.3253102922f,0.3267604523f,0.3282098436f,0.3296584625f,0.3311063058f,0.3325533699f,0.3339996514f,0.3354451471f,
    0.3368898534f,0.3383337670f,0.3397768844f,0.3412192023f,0.3426607173f,0.3441014260f,0.3455413250f,0.3469804108f,
    0.3484186802f,0.3498561298f,0.3512927561f,0.3527285558f,0.3541635254f,0.3555976617f,0.3570309612f,0.3584634206f,
    0.3598950365f,0.3613258056f,0.3627557244f,0.3641847896f,0.3656129978f,0.3670403457f,0.3684668300f,0.3698924471f,
    0.3713171940f,0.3727410670f,0.3741640630f,0.3755861785f,0.3770074102f,0.3784277548f,0.3798472089f,0.3812657692f,
    0.3826834324f,0.3841001950f,0.3855160538f,0.3869310055f,0.3883450467f,0.3897581741f,0.3911703843f,0.3925816741f,
    0.3939920401f,0.3954014789f,0.3968099874f,0.3982175622f,0.3996241998f,0.4010298972f,0.4024346509f,0.4038384576f,
    0.4052413140f,0.4066432169f,0.4080441629f,0.4094441487f,0.4108431711f,0.4122412267f,0.4136383122f,0.4150344245f,
    0.4164295601f,0.4178237158f,0.4192168884f,0.4206090744f,0.4220002708f,0.4233904741f,0.4247796812f,0.4261678887f,
    0.4275550934f,0.4289412921f,0.4303264813f,0.4317106580f,0.4330938189f,0.4344759606f,0.4358570799f,0.4372371737f,
    0.4386162385f,0.4399942713f,0.4413712687f,0.4427472276f,0.4441221446f,0.4454960165f,0.4468688402f,0.4482406123f,
    0.4496113297f,0.4509809890f,0.4523495872f,0.4537171210f,0.4550835871f,0.4564489824f,0.4578133036f,0.4591765475f,
    0.4605387110f,0.4618997907f,0.4632597836f,0.4646186863f,0.4659764958f,0.4673332087f,0.4686888220f,0.4700433325f,
    0.4713967368f,0.4727490320f,0.4741002147f,0.4754502817f,0.4767992301f,0.4781470564f,0.4794937577f,0.4808393306f,
    0.4821837721f,0.4835270789f,0.4848692480f,0.4862102761f,0.4875501601f,0.4888888969f,0.4902264833f,0.4915629161f,
    0.4928981922f,0.4942323085f,0.4955652618f,0.4968970490f,0.4982276670f,0.4995571125f,0.5008853826f,0.5022124740f,
    0.5035383837f,0.5048631085f,0.5061866453f,0.5075089911f,0.5088301425f,0.5101500967f,0.5114688504f,0.5127864006f,
    0.5141027442f,0.5154178780f,0.5167317990f,0.5180445041f,0.5193559902f,0.5206662541f,0.5219752929f,0.5232831035f,
    0.5245896827f,0.5258950275f,0.5271991348f,0.5285020015f,0.5298036247f,0.5311040012f,0.5324031279f,0.5337010018f,
    0.5349976199f,0.5362929791f,0.5375870763f,0.5388799085f,0.5401714727f,0.5414617659f,0.5427507849f,0.5440385267f,
    0.5453249884f,0.5466101669f,0.5478940592f,0.5491766622f,0.5504579729f,0.5517379884f,0.5530167056f,0.5542941215f,
    0.5555702330f,0.5568450373f,0.5581185312f,0.5593907119f,0.5606615762f,0.5619311212f,0.5631993440f,0.5644662415f,
    0.5657318108f,0.5669960488f,0.5682589527f,0.5695205193f,0.5707807459f,0.5720396293f,0.5732971667f,0.5745533550f,
    0.5758081914f,0.5770616729f,0.5783137964f,0.5795645591f,0.5808139581f,0.5820619903f,0.5833086529f,0.5845539430f,
    0.5857978575f,0.5870403935f,0.5882815482f,0.5895213186f,0.5907597019f,0.5919966950f,0.5932322950f,0.5944664992f,
    0.5956993045f,0.5969307081f,0.5981607070f,0.5993892984f,0.6006164794f,0.6018422471f,0.6030665985f,0.6042895309f,
    0.6055110414f,0.6067311270f,0.6079497850f,0.6091670123f,0.6103828063f,0.6115971639f,0.6128100824f,0.6140215589f,
    0.6152315906f,0.6164401745f,0.6176473079f,0.6188529880f,0.6200572118f,0.6212599765f,0.6224612794f,0.6236611175f,
    0.6248594881f,0.6260563884f,0.6272518155f,0.6284457666f,0.6296382389f,0.6308292296f,0.6320187359f,0.6332067551f,
    0.6343932842f,0.6355783205f,0.6367618612f,0.6379439036f,0.6391244449f,0.6403034822f,0.6414810128f,0.6426570340f,
    0.6438315429f,0.6450045368f,0.6461760130f,0.6473459686f,0.6485144010f,0.6496813074f,0.6508466850f,0.6520105311f,
    0.6531728430f,0.6543336178f,0.6554928530f,0.6566505457f,0.6578066933f,0.6589612930f,0.6601143421f,0.6612658378f,
    0.6624157776f,0.6635641586f,0.6647109782f,0.6658562337f,0.6669999223f,0.6681420414f,0.6692825883f,0.6704215604f,
    0.6715589548f,0.6726947691f,0.6738290004f,0.6749616461f,0.6760927036f,0.6772221701f,0.6783500431f,0.6794763199f,
    0.6806009978f,0.6817240742f,0.6828455464f,0.6839654118f,0.6850836678f,0.6862003117f,0.6873153409f,0.6884287528f,
    0.6895405447f,0.6906507141f,0.6917592584f,0.6928661748f,0.6939714609f,0.6950751140f,0.6961771315f,0.6972775108f,
    0.6983762494f,0.6994733446f,0.7005687939f,0.7016625947f,0.7027547445f,0.7038452405f,0.7049340804f,0.7060212614f,
    0.7071067812f,0.7081906370f,0.7092728264f,0.7103533469f,0.7114321957f,0.7125093706f,0.7135848688f,0.7146586879f,
    0.7157308253f,0.7168012785f,0.7178700451f,0.7189371224f,0.7200025080f,0.7210661993f,0.7221281939f,0.7231884893f,
    0.7242470830f,0.7253039724f,0.7263591551f,0.7274126286f,0.7284643904f,0.7295144381f,0.7305627692f,0.7316093812f,
    0.7326542717f,0.7336974381f,0.7347388781f,0.7357785892f,0.7368165689f,0.7378528148f,0.7388873245f,0.7399200955f,
    0.7409511254f,0.7419804117f,0.7430079521f,0.7440337442f,0.7450577854f,0.7460800735f,0.7471006060f,0.7481193805f,
    0.7491363945f,0.7501516458f,0.7511651319f,0.7521768504f,0.7531867990f,0.7541949753f,0.7552013769f,0.7562060014f,
    0.7572088465f,0.7582099098f,0.7592091890f,0.7602066817f,0.7612023855f,0.7621962981f,0.7631884173f,0.7641787405f,
    0.7651672656f,0.7661539902f,0.7671389119f,0.7681220285f,0.7691033376f,0.7700828370f,0.7710605243f,0.7720363972f,
    0.7730104534f,0.7739826906f,0.7749531066f,0.7759216990f,0.7768884657f,0.7778534042f,0.7788165124f,0.7797777879f,
    0.7807372286f,0.7816948321f,0.7826505962f,0.7836045186f,0.7845565972f,0.7855068296f,0.7864552136f,0.7874017470f,
    0.7883464276f,0.7892892532f,0.7902302214f,0.7911693302f,0.7921065773f,0.7930419605f,0.7939754776f,0.7949071263f,
    0.7958369046f,0.7967648102f,0.7976908409f,0.7986149946f,0.7995372691f,0.8004576622f,0.8013761717f,0.8022927955f,
    0.8032075315f,0.8041203774f,0.8050313311f,0.8059403906f,0.8068475535f,0.8077528179f,0.8086561816f,0.8095576424f,
    0.8104571983f,0.8113548470f,0.8122505866f,0.8131444148f,0.8140363297f,0.8149263291f,0.8158144108f,0.8167005729f,
    0.8175848132f,0.8184671296f,0.8193475201f,0.8202259826f,0.8211025150f,0.8219771153f,0.8228497814f,0.8237205112f,
    0.8245893028f,0.8254561540f,0.8263210628f,0.8271840273f,0.8280450453f,0.8289041148f,0.8297612338f,0.8306164003f,
    0.8314696123f,0.8323208678f,0.8331701647f,0.8340175011f,0.8348628750f,0.8357062844f,0.8365477272f,0.8373872016f,
    0.8382247056f,0.8390602371f,0.8398937942f,0.8407253750f,0.8415549774f,0.8423825996f,0.8432082396f,0.8440318955f,
    0.8448535652f,0.8456732470f,0.8464909388f,0.8473066387f,0.8481203448f,0.8489320552f,0.8497417680f,0.8505494813f,
    0.8513551931f,0.8521589016f,0.8529606049f,0.8537603011f,0.8545579884f,0.8553536647f,0.8561473284f,0.8569389774f,
    0.8577286100f,0.8585162243f,0.8593018184f,0.8600853904f,0.8608669386f,0.8616464611f,0.8624239561f,0.8631994217f,
    0.8639728561f,0.8647442575f,0.8655136241f,0.8662809540f,0.8670462455f,0.8678094968f,0.8685707060f,0.8693298713f,
    0.8700869911f,0.8708420635f,0.8715950867f,0.8723460589f,0.8730949784f,0.8738418435f,0.8745866523f,0.8753294031f,
    0.8760700942f,0.8768087238f,0.8775452902f,0.8782797917f,0.8790122264f,0.8797425928f,0.8804708891f,0.8811971135f,
    0.8819212643f,0.8826433400f,0.8833633387f,0.8840812587f,0.8847970984f,0.8855108561f,0.8862225301f,0.8869321188f,
    0.8876396204f,0.8883450333f,0.8890483559f,0.8897495864f,0.8904487232f,0.8911457648f,0.8918407094f,0.8925335554f,
    0.8932243012f,0.8939129451f,0.8945994856f,0.8952839210f,0.8959662498f,0.8966464702f,0.8973245807f,0.8980005797f,
    0.8986744657f,0.8993462370f,0.9000158920f,0.9006834292f,0.9013488470f,0.9020121439f,0.9026733182f,0.9033323685f,
    0.9039892931f,0.9046440906f,0.9052967593f,0.9059472978f,0.9065957045f,0.9072419779f,0.9078861165f,0.9085281187f,
    0.9091679831f,0.9098057081f,0.9104412923f,0.9110747341f,0.9117060320f,0.9123351846f,0.9129621904f,0.9135870479f,
    0.9142097557f,0.9148303122f,0.9154487161f,0.9160649658f,0.9166790599f,0.9172909970f,0.9179007756f,0.9185083943f,
    0.9191138517f,0.9197171463f,0.9203182767f,0.9209172415f,0.9215140393f,0.9221086687f,0.9227011283f,0.9232914167f,
    0.9238795325f,0.9244654743f,0.9250492408f,0.9256308305f,0.9262102421f,0.9267874743f,0.9273625257f,0.9279353948f,
    0.9285060805f,0.9290745813f,0.9296408958f,0.9302050229f,0.9307669611f,0.9313267091f,0.9318842656f,0.9324396293f,
    0.9329927988f,0.9335437730f,0.9340925504f,0.9346391298f,0.9351835099f,0.9357256895f,0.9362656672f,0.9368034417f,
    0.9373390119f,0.9378723764f,0.9384035341f,0.9389324835f,0.9394592236f,0.9399837530f,0.9405060706f,0.9410261751f,
    0.9415440652f,0.9420597398f,0.9425731976f,0.9430844375f,0.9435934582f,0.9441002585f,0.9446048373f,0.9451071933f,
    0.9456073254f,0.9461052324f,0.9466009131f,0.9470943664f,0.9475855910f,0.9480745859f,0.9485613499f,0.9490458819f,
    0.9495281806f,0.9500082450f,0.9504860739f,0.9509616663f,0.9514350210f,0.9519061368f,0.9523750127f,0.9528416476f,
    0.9533060404f,0.9537681899f,0.9542280951f,0.9546857549f,0.9551411683f,0.9555943341f,0.9560452513f,0.9564939189f,
    0.9569403357f,0.9573845008f,0.9578264130f,0.9582660714f,0.9587034749f,0.9591386225f,0.9595715131f,0.9600021457f,
    0.9604305194f,0.9608566331f,0.9612804858f,0.9617020765f,0.9621214043f,0.9625384680f,0.9629532669f,0.9633657998f,
    0.9637760658f,0.9641840640f,0.9645897933f,0.9649932529f,0.9653944417f,0.9657933589f,0.9661900034f,0.9665843745f,
    0.9669764710f,0.9673662922f,0.9677538371f,0.9681391047f,0.9685220943f,0.9689028048f,0.9692812354f,0.9696573851f,
    0.9700312532f,0.9704028387f,0.9707721407f,0.9711391584f,0.9715038910f,0.9718663375f,0.9722264971f,0.9725843689f,
    0.9729399522f,0.9732932461f,0.9736442497f,0.9739929622f,0.9743393828f,0.9746835107f,0.9750253451f,0.9753648851f,
    0.9757021300f,0.9760370790f,0.9763697313f,0.9767000861f,0.9770281427f,0.9773539001f,0.9776773578f,0.9779985149f,
    0.9783173707f,0.9786339244f,0.9789481753f,0.9792601226f,0.9795697657f,0.9798771037f,0.9801821360f,0.9804848618f,
    0.9807852804f,0.9810833912f,0.9813791933f,0.9816726862f,0.9819638691f,0.9822527414f,0.9825393023f,0.9828235512f,
    0.9831054874f,0.9833851103f,0.9836624192f,0.9839374134f,0.9842100924f,0.9844804554f,0.9847485018f,0.9850142310f,
    0.9852776424f,0.9855387353f,0.9857975092f,0.9860539633f,0.9863080972f,0.9865599103f,0.9868094018f,0.9870565713f,
    0.9873014182f,0.9875439418f,0.9877841416f,0.9880220171f,0.9882575677f,0.9884907929f,0.9887216920f,0.9889502645f,
    0.9891765100f,0.9894004278f,0.9896220175f,0.9898412785f,0.9900582103f,0.9902728124f,0.9904850843f,0.9906950254f,
    0.9909026354f,0.9911079137f,0.9913108598f,0.9915114733f,0.9917097537f,0.9919057004f,0.9920993131f,0.9922905913f,
    0.9924795346f,0.9926661424f,0.9928504145f,0.9930323502f,0.9932119492f,0.9933892111f,0.9935641355f,0.9937367219f,
    0.9939069700f,0.9940748793f,0.9942404495f,0.9944036801f,0.9945645707f,0.9947231211f,0.9948793308f,0.9950331994f,
    0.9951847267f,0.9953339121f,0.9954807555f,0.9956252564f,0.9957674145f,0.9959072294f,0.9960447009f,0.9961798286f,
    0.9963126122f,0.9964430514f,0.9965711458f,0.9966968952f,0.9968202993f,0.9969413578f,0.9970600703f,0.9971764367f,
    0.9972904567f,0.9974021299f,0.9975114561f,0.9976184351f,0.9977230666f,0.9978253504f,0.9979252862f,0.9980228738f,
    0.9981181129f,0.9982110034f,0.9983015449f,0.9983897374f,0.9984755806f,0.9985590742f,0.9986402182f,0.9987190122f,
    0.9987954562f,0.9988695499f,0.9989412932f,0.9990106859f,0.9990777278f,0.9991424187f,0.9992047586f,0.9992647473f,
    0.9993223846f,0.9993776704f,0.9994306046f,0.9994811870f,0.9995294175f,0.9995752960f,0.9996188225f,0.9996599967f,
    0.9996988187f,0.9997352883f,0.9997694054f,0.9998011699f,0.9998305818f,0.9998576410f,0.9998823475f,0.9999047011f,
    0.9999247018f,0.9999423497f,0.9999576446f,0.9999705864f,0.9999811753f,0.9999894111f,0.9999952938f,0.9999988235f,
    1.0000000000f
};

static const float rad_to_step = 2048.0f / M_PI;

float sin1(float rad /*0...2PI*/) {
    uint16_t angle = rad * rad_to_step;

    // get lower 12 bits; normalize to 0...4096 for [0, 2pi]
    angle &= 4095;

    if ((angle & 2048) == 0) {          // 0...2047
        if ((angle & 1024) == 0) {      // 0...1023
            return sin_lookup[angle];
        } else {                        // 1024...2047
            return sin_lookup[2048 - angle];
        }
    } else {                            // 2048...4095
        if ((angle & 1024) == 0) {      // 2048...3071
            return -sin_lookup[angle - 2048];
        } else {                        // 3072...4095
            return -sin_lookup[4096 - angle];
        }
    }
}
